<?xml version="1.0" encoding="UTF-8" ?>
<!-- use this solrconfig file to experiment with Solr without replication -->
<config>
  <!-- NOTE: various comments and unused configuration possibilities have been purged
     from this file.  Please refer to http://wiki.apache.org/solr/SolrConfigXml,
     as well as the default solrconfig file included with Solr -->

  <abortOnConfigurationError>${solr.abortOnConfigurationError:true}</abortOnConfigurationError>

  <luceneMatchVersion>4.4</luceneMatchVersion>

  <dataDir>${solr.data.dir:}</dataDir>

  <directoryFactory name="DirectoryFactory" class="${solr.directoryFactory:solr.NRTCachingDirectoryFactory}"/>
  <codecFactory class="solr.SchemaCodecFactory"/>
  <schemaFactory class="ClassicIndexSchemaFactory"/>

  <indexConfig>
		<lockType>${solr.lock.type:native}</lockType>
    <unlockOnStartup>true</unlockOnStartup>
    <reopenReaders>true</reopenReaders>
    <infoStream>true</infoStream>
  </indexConfig>

  <!-- See docs re: autoCommit -->
  <updateHandler class="solr.DirectUpdateHandler2">
    <updateLog>
      <str name="dir">${solr.data.dir:}</str>
    </updateLog>
    <autoCommit>
       <maxDocs>20000</maxDocs>
       <openSearcher>false</openSearcher>
    </autoCommit>
  </updateHandler>

  <query>
    <maxBooleanClauses>1024</maxBooleanClauses>
    <filterCache class="solr.FastLRUCache" size="512" initialSize="512" autowarmCount="0"/>
    <queryResultCache class="solr.LRUCache" size="512" initialSize="512" autowarmCount="0"/>
    <documentCache class="solr.LRUCache" size="512" initialSize="512" autowarmCount="0"/>
    <enableLazyFieldLoading>true</enableLazyFieldLoading>
    <queryResultWindowSize>80</queryResultWindowSize>
    <queryResultMaxDocsCached>200</queryResultMaxDocsCached>
    <useColdSearcher>true</useColdSearcher>
    <maxWarmingSearchers>1</maxWarmingSearchers>
  </query>

  <!-- Let the dispatch filter handler /select?qt=XXX -->
  <requestDispatcher handleSelect="true" >
    <!--Make sure your system has some authentication before enabling remote streaming!  -->
    <requestParsers enableRemoteStreaming="true" multipartUploadLimitInKB="2048000" addHttpRequestToContext="false"/>
    <httpCaching lastModifiedFrom="openTime" etagSeed="Solr" />
  </requestDispatcher>

	<!-- these are required by Solr Cloud -->
	<requestHandler name="/replication" class="solr.ReplicationHandler" startup="lazy" />
	<requestHandler name="/get" class="solr.RealTimeGetHandler">
		<lst name="defaults">
			<str name="omitHeader">true</str>
		</lst>
	</requestHandler>

  <!-- for most searches -->
  <requestHandler name="search" class="solr.SearchHandler" default="true">
    <lst name="defaults">
      <str name="echoParams">explicit</str>
      <str name="defType">edismax</str>
      <bool name="lowercaseOperators">false</bool>
      <str name="sort">score desc</str>
      <int name="rows">20</int>
      <str name="q.alt">*:*</str>
      <str name="mm">6&lt;-1 6&lt;90%</str>
      <int name="qs">1</int>
      <int name="ps">0</int>
      <float name="tie">0.01</float>
      <!-- in case lucene query parser -->
      <str name="df">all_search</str>
      <str name="q.op">AND</str>
      <str name="qf">
        id
      </str>

			<str name="fl">score, *</str>

      <bool name="facet">true</bool>
      <int name="facet.mincount">1</int>
      <int name="facet.limit">21</int>

			<!-- genre -->
      <str name="facet.field">f655_ssim</str>
      <str name="facet.field">f655a_ssim</str>
      <str name="facet.field">f655b_ssim</str>
      <str name="facet.field">f655c_ssim</str>
      <str name="facet.field">f655abc_ssim</str>

			<!-- BCE dates -->
      <str name="facet.field">f046_ssim</str>
      <str name="facet.field">f046a_ssim</str>
      <str name="facet.field">f046b_ssim</str>
      <str name="facet.field">f046c_ssim</str>
      <str name="facet.field">f046d_ssim</str>
      <str name="facet.field">f046e_ssim</str>

      <str name="facet.field">f008_35-37_si</str>
      <str name="facet.field">f040_sim</str>
      <str name="facet.field">f040b_sim</str>

      <str name="facet.field">format</str>
        <int name="f.format.facet.limit">20</int>
        <str name="f.format.facet.method">enum</str>
      <str name="facet.field">language</str>
    </lst>
  </requestHandler>

  <!-- single document requests; use id=666 instead of q=id:666 -->
  <requestHandler name="document" class="solr.SearchHandler" >
    <lst name="defaults">
      <str name="echoParams">explicit</str>
      <str name="fl">*</str>
      <int name="rows">1</int>
      <str name="q">{!raw f=id v=$id}</str> <!-- use id=666 instead of q=id:666 -->
    </lst>
  </requestHandler>

  <!-- used to get consecutive terms for browsing -->
  <searchComponent name="termsComp" class="solr.TermsComponent"/>
  <requestHandler name="/alphaTerms" class="solr.SearchHandler">
    <lst name="defaults">
      <str name="echoParams">explicit</str>
      <bool name="terms">true</bool>
      <bool name="terms.lower.incl">true</bool>
    </lst>
    <arr name="components">
      <str>termsComp</str>
    </arr>
  </requestHandler>

  <!-- basic defType=lucene request handler -->
  <requestHandler name="standard" class="solr.SearchHandler" >
    <lst name="defaults">
      <str name="defType">lucene</str>
      <str name="echoParams">explicit</str>
      <str name="df">all_search</str>
      <str name="q.op">AND</str>
      <str name="sort">score desc</str>

      <bool name="facet">true</bool>
      <int name="facet.mincount">1</int>
      <int name="facet.limit">21</int>

			<!-- genre -->
      <str name="facet.field">f655_ssim</str>
      <str name="facet.field">f655a_ssim</str>
      <str name="facet.field">f655b_ssim</str>
      <str name="facet.field">f655c_ssim</str>
      <str name="facet.field">f655abc_ssim</str>

			<!-- BCE dates -->
      <str name="facet.field">f046_ssim</str>
      <str name="facet.field">f046a_ssim</str>
      <str name="facet.field">f046b_ssim</str>
      <str name="facet.field">f046c_ssim</str>
      <str name="facet.field">f046d_ssim</str>
      <str name="facet.field">f046e_ssim</str>

      <str name="facet.field">f008_35-37_si</str>
      <str name="facet.field">f040_sim</str>
      <str name="facet.field">f040b_sim</str>

      <str name="facet.field">format</str>
        <int name="f.format.facet.limit">20</int>
        <str name="f.format.facet.method">enum</str>
      <str name="facet.field">language</str>
    </lst>
  </requestHandler>

  <searchComponent name="tvComponent" class="org.apache.solr.handler.component.TermVectorComponent"/>
  <requestHandler name="tvrh" class="org.apache.solr.handler.component.SearchHandler">
    <lst name="defaults">
      <bool name="tv">true</bool>
      <bool name="tv.all">true</bool>
      <str name="defType">dismax</str>
      <str name="q.alt">*:*</str>
    </lst>
    <arr name="last-components">
      <str>tvComponent</str>
    </arr>
  </requestHandler>

	<requestHandler name="/update" class="solr.XmlUpdateRequestHandler" startup="lazy"/>
  <requestHandler name="/analysis/field" startup="lazy" class="solr.FieldAnalysisRequestHandler" />
  <requestHandler name="/admin/" class="org.apache.solr.handler.admin.AdminHandlers" />
  <requestHandler name="/admin/ping" class="solr.PingRequestHandler">
    <lst name="invariants">
      <str name="q">ping test query</str>
      <str name="qt">search</str>
    </lst>
  </requestHandler>

  <admin>
    <defaultQuery>admin test query</defaultQuery>
  </admin>

</config>
